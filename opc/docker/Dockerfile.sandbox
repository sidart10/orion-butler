# Sandbox Container for OPC Cross-Agent Code Execution
#
# Security features:
# - Non-root user
# - No network access (configured in docker run)
# - Read-only filesystem (except /tmp)
# - Resource limits (configured in docker run)
#
# Build:
#   docker build -f docker/Dockerfile.sandbox -t claude-sandbox .
#
# Usage (via SandboxClient):
#   docker run --rm --network none --read-only \
#     --memory 512m --cpus 0.5 \
#     -i claude-sandbox < '{"code": "result = 1 + 1"}'

FROM python:3.12-slim

# Security: non-root user
RUN useradd -m -s /bin/bash sandbox

# Install common computation libraries
RUN pip install --no-cache-dir \
    numpy>=1.26 \
    scipy>=1.11 \
    sympy>=1.12 \
    pandas>=2.0

# Switch to non-root user
USER sandbox
WORKDIR /home/sandbox

# Copy sandbox runner
COPY --chown=sandbox:sandbox docker/sandbox_runner.py /home/sandbox/

# Default entrypoint
ENTRYPOINT ["python", "sandbox_runner.py"]
