<?xml version="1.0" encoding="UTF-8"?>
<!--
  Story Context File for DEV Agent
  Generated: 2026-01-15
  Story: 1-3-design-system-foundation
  Epic: 1 - Foundation & First Chat
-->
<story-context>
  <metadata>
    <story-id>1-3-design-system-foundation</story-id>
    <epic-id>1</epic-id>
    <epic-name>Foundation and First Chat</epic-name>
    <status>ready-for-dev</status>
    <priority>P1</priority>
    <risk-level>LOW</risk-level>
    <generated>2026-01-15</generated>
  </metadata>

  <story>
    <title>Design System Foundation</title>
    <user-story>
      As a user,
      I want Orion to have a distinctive editorial luxury aesthetic,
      So that it feels premium and differentiated from other tools.
    </user-story>

    <dependencies>
      <dependency type="prerequisite">Story 1.2 (Next.js Frontend Integration) - needs working Next.js app</dependency>
      <dependency type="parallel">Story 1.4 (SQLite Database) - can be developed in parallel</dependency>
      <dependency type="enables">Story 1.9 (Split-Screen Layout) - uses layout variables from this story</dependency>
    </dependencies>
  </story>

  <acceptance-criteria>
    <ac id="1" name="Typography System">
      <given>the app is running</given>
      <when>any screen loads</when>
      <then>
        <condition>typography uses Playfair Display for headlines (serif class)</condition>
        <condition>typography uses Inter for body text (sans-serif default)</condition>
        <condition>fonts are preloaded via Google Fonts for fast rendering</condition>
      </then>
    </ac>

    <ac id="2" name="Color Palette">
      <given>the design system is configured</given>
      <when>developers use Tailwind classes</when>
      <then>
        <condition>colors follow palette: Gold #D4AF37, Cream #F9F8F6, Black #1A1A1A</condition>
        <condition>color tokens available as orion-primary, orion-bg, orion-fg</condition>
        <condition>extended palette includes muted/subtle/faint variants</condition>
      </then>
    </ac>

    <ac id="3" name="Zero Border Radius">
      <given>the app is running</given>
      <when>any component renders</when>
      <then>
        <condition>all corners are sharp (zero border radius) throughout</condition>
        <condition>shadcn/ui components inherit zero radius via CSS variable override</condition>
      </then>
    </ac>

    <ac id="4" name="Layout Grid">
      <given>the app shell is rendered</given>
      <when>the main layout displays</when>
      <then>
        <condition>layout follows grid: 80px header, 280px sidebar, 64px agent rail</condition>
        <condition>content max width constrained to 850px</condition>
        <condition>CSS custom properties available for layout dimensions</condition>
      </then>
    </ac>

    <ac id="5" name="Tailwind Configuration">
      <given>the design system is implemented</given>
      <when>a developer creates a new component</when>
      <then>
        <condition>Tailwind/CSS tokens enforce design constraints</condition>
        <condition>design system preset integrates cleanly with app tailwind.config</condition>
        <condition>deviations from design system are visually obvious</condition>
      </then>
    </ac>

    <ac id="6" name="Component Classes">
      <given>the design system is implemented</given>
      <when>developers build UI</when>
      <then>
        <condition>component classes available: .btn-gold-slide, .luxury-card, .input-editorial, .chat-user, .chat-agent</condition>
        <condition>utility classes work: .serif, .tracking-editorial, .tracking-luxury, .grid-bg</condition>
      </then>
    </ac>

    <ac id="7" name="Accessibility">
      <given>the color palette is applied</given>
      <when>text is displayed on backgrounds</when>
      <then>
        <condition>color contrast meets WCAG AA (4.5:1 minimum for normal text)</condition>
        <condition>gold accent on cream background passes contrast requirements</condition>
      </then>
    </ac>
  </acceptance-criteria>

  <tasks>
    <task id="1" ac="1">
      <name>Google Fonts Integration</name>
      <subtasks>
        <subtask>Update src/app/layout.tsx to include Google Fonts preconnect links</subtask>
        <subtask>Add font CSS import for Inter (100-900 weights) and Playfair Display (400-900, italic)</subtask>
        <subtask>Verify fonts load correctly with Network panel check</subtask>
        <subtask>Add font-display: swap for progressive loading</subtask>
      </subtasks>
    </task>

    <task id="2" ac="2,3,4,5,6">
      <name>Design System Import into App</name>
      <subtasks>
        <subtask>Import design system global styles in src/app/globals.css</subtask>
        <subtask>Create/update root tailwind.config.ts to use Orion preset</subtask>
        <subtask>Verify Tailwind builds with design system tokens (run pnpm dev)</subtask>
        <subtask>Test that bg-orion-primary, text-orion-fg, bg-orion-bg classes work</subtask>
      </subtasks>
    </task>

    <task id="3" ac="4">
      <name>CSS Variables for Layout</name>
      <subtasks>
        <subtask>Add CSS custom properties to globals.css (if not already in design-system)</subtask>
        <subtask>Verify CSS variables are accessible from components</subtask>
      </subtasks>
    </task>

    <task id="4" ac="3,5">
      <name>shadcn/ui Integration</name>
      <subtasks>
        <subtask>Initialize shadcn/ui in project: pnpm dlx shadcn@latest init</subtask>
        <subtask>Configure components.json with Orion settings</subtask>
        <subtask>Override shadcn CSS variables to use Orion tokens in globals.css</subtask>
        <subtask>Install sample shadcn component to verify integration: pnpm dlx shadcn@latest add button</subtask>
        <subtask>Verify Button component renders with zero border radius</subtask>
      </subtasks>
    </task>

    <task id="5" ac="1">
      <name>Typography Verification</name>
      <subtasks>
        <subtask>Create test component with serif headline and body text</subtask>
        <subtask>Verify serif class applies Playfair Display</subtask>
        <subtask>Verify default font is Inter</subtask>
        <subtask>Test editorial tracking classes</subtask>
      </subtasks>
    </task>

    <task id="6" ac="6">
      <name>Component Classes Verification</name>
      <subtasks>
        <subtask>Create test page with all component classes</subtask>
        <subtask>Verify .grid-bg creates 40px grid pattern</subtask>
        <subtask>Verify .dots-bg creates dot pattern</subtask>
      </subtasks>
    </task>

    <task id="7" ac="7">
      <name>Accessibility Audit</name>
      <subtasks>
        <subtask>Test Gold (#D4AF37) on Cream (#F9F8F6) - verify contrast ratio</subtask>
        <subtask>Test Black (#1A1A1A) on Cream (#F9F8F6) - verify contrast ratio</subtask>
        <subtask>Test Cream text on Black background - verify contrast ratio</subtask>
        <subtask>Use browser DevTools or axe extension to verify WCAG AA compliance</subtask>
        <subtask>Document any contrast concerns with gold accent</subtask>
      </subtasks>
    </task>

    <task id="8" ac="5">
      <name>Animation System Verification</name>
      <subtasks>
        <subtask>Test animation classes: animate-reveal, animate-reveal-1, animate-reveal-2</subtask>
        <subtask>Verify easing classes: ease-luxury, ease-elegant</subtask>
        <subtask>Verify duration classes: duration-500, duration-700, duration-1200</subtask>
        <subtask>Test staggered reveal animation pattern</subtask>
      </subtasks>
    </task>

    <task id="9" ac="1,2,3,4,5,6">
      <name>Visual Regression Setup</name>
      <subtasks>
        <subtask>Create tests/visual/design-system.spec.ts with Playwright</subtask>
        <subtask>Capture baseline screenshots for typography, colors, components, layout</subtask>
        <subtask>Configure Playwright visual comparison threshold</subtask>
      </subtasks>
    </task>
  </tasks>

  <atdd-summary>
    <test-metrics>
      <total-scenarios>28</total-scenarios>
      <unit-tests>10</unit-tests>
      <integration-tests>4</integration-tests>
      <e2e-visual-tests>12</e2e-visual-tests>
      <accessibility-tests>2</accessibility-tests>
    </test-metrics>

    <key-tests>
      <test id="1.3.1">Verify serif class maps to Playfair Display</test>
      <test id="1.3.2">Verify sans class maps to Inter</test>
      <test id="1.3.7">Gold color token is #D4AF37</test>
      <test id="1.3.8">Cream color token is #F9F8F6</test>
      <test id="1.3.9">Black color token is #1A1A1A</test>
      <test id="1.3.13">shadcn Button has zero border radius</test>
      <test id="1.3.16">CSS variable --radius is 0</test>
      <test id="1.3.17">CSS variable --orion-header-height is 80px</test>
      <test id="1.3.30">Black on Cream contrast >= 14:1</test>
      <test id="1.3.31">axe-core finds no contrast violations</test>
    </key-tests>

    <gate-criteria>
      <criterion name="Unit tests passing" threshold="10/10"/>
      <criterion name="Integration tests passing" threshold="4/4"/>
      <criterion name="E2E tests passing" threshold="12/12"/>
      <criterion name="Accessibility tests passing" threshold="2/2"/>
      <criterion name="Visual regression captured" threshold="Yes"/>
      <criterion name="WCAG AA contrast" threshold="All pass"/>
    </gate-criteria>

    <checklist-location>./atdd-checklist-1-3-design-system-foundation.md</checklist-location>
  </atdd-summary>

  <architecture-patterns>
    <design-philosophy>
      <principle name="Zero border radius">Sharp, architectural edges throughout</principle>
      <principle name="Generous whitespace">Breathing room, minimal density</principle>
      <principle name="Black and Gold">Monochrome with strategic gold highlights</principle>
      <principle name="Serif headlines">Playfair Display italics for elegance</principle>
      <principle name="Micro typography">9-11px uppercase tracking for labels</principle>
      <principle name="Grayscale imagery">Images start B/W, reveal color on hover</principle>
    </design-philosophy>

    <fonts>
      <font name="Playfair Display" usage="Headlines, quotes, emphasis" weights="400-900, italic"/>
      <font name="Inter" usage="Body text, labels, UI" weights="100-900"/>
      <preload-snippet><![CDATA[
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&family=Playfair+Display:ital,wght@0,400;0,500;0,600;0,700;0,800;0,900;1,400;1,500;1,600;1,700&display=swap" rel="stylesheet">
      ]]></preload-snippet>
    </fonts>

    <color-palette>
      <color name="Primary (Gold)" hex="#D4AF37" css-var="--orion-primary" usage="CTAs, highlights, accent"/>
      <color name="Background (Cream)" hex="#F9F8F6" css-var="--orion-bg" usage="Page background"/>
      <color name="Foreground (Black)" hex="#1A1A1A" css-var="--orion-fg" usage="Text, borders"/>
    </color-palette>

    <layout-dimensions>
      <dimension name="Header height" value="80px" css-var="--orion-header-height"/>
      <dimension name="Sidebar width" value="280px" css-var="--orion-sidebar-width"/>
      <dimension name="Sidebar collapsed" value="72px" css-var="--orion-sidebar-collapsed"/>
      <dimension name="Agent rail width" value="64px" css-var="--orion-rail-width"/>
      <dimension name="Content max width" value="850px" css-var="--orion-content-max-width"/>
      <dimension name="Chat width" value="480px" css-var="--orion-chat-width"/>
    </layout-dimensions>

    <shadcn-integration>
      <css-variable-overrides><![CDATA[
:root {
  --background: 38 33% 97%;     /* Orion cream #F9F8F6 */
  --foreground: 0 0% 10%;       /* Orion black #1A1A1A */
  --primary: 43 65% 52%;        /* Orion gold #D4AF37 */
  --primary-foreground: 0 0% 100%;
  --secondary: 38 33% 92%;
  --secondary-foreground: 0 0% 10%;
  --muted: 38 20% 90%;
  --muted-foreground: 0 0% 40%;
  --accent: 43 65% 52%;
  --accent-foreground: 0 0% 100%;
  --destructive: 0 84% 60%;
  --destructive-foreground: 0 0% 100%;
  --border: 0 0% 10%;
  --input: 0 0% 10%;
  --ring: 43 65% 52%;           /* Gold focus ring */
  --radius: 0rem;               /* Sharp corners */
}
      ]]></css-variable-overrides>
    </shadcn-integration>

    <component-classes>
      <class name=".btn-gold-slide">Primary CTA with gold slide-in hover effect</class>
      <class name=".luxury-card">Card with top border, grayscale-to-color images</class>
      <class name=".input-editorial">Underline-only input with serif italic placeholder</class>
      <class name=".grid-bg">40px grid pattern at 3% opacity</class>
      <class name=".dots-bg">24px dot pattern background</class>
      <class name=".chat-user">User message (black bg, cream text)</class>
      <class name=".chat-agent">Agent message (gold left border)</class>
      <class name=".serif">Apply Playfair Display font</class>
    </component-classes>
  </architecture-patterns>

  <existing-resources>
    <note>IMPORTANT: The design system has already been extracted and lives in /design-system/. This story is about INTEGRATING it into the Next.js app, not creating it from scratch.</note>

    <file-structure><![CDATA[
design-system/
├── tokens/
│   ├── colors.ts          # Color palette
│   ├── typography.ts      # Fonts, sizes, spacing
│   ├── spacing.ts         # Spacing, layout dimensions
│   ├── animations.ts      # Easing, keyframes, durations
│   ├── effects.ts         # Shadows, filters, patterns
│   └── index.ts           # Token exports
├── styles/
│   └── globals.css        # Global CSS with all styles
├── tailwind.config.ts     # Tailwind preset (orionTailwindPreset)
├── index.ts               # Main entry point
└── README.md              # Full documentation
    ]]></file-structure>

    <integration-steps>
      <step n="1">Import global styles in src/app/globals.css: @import '../../design-system/styles/globals.css';</step>
      <step n="2">Configure Tailwind in tailwind.config.ts using orionTailwindPreset</step>
      <step n="3">Use typed tokens in components via import from @/design-system</step>
    </integration-steps>
  </existing-resources>

  <accessibility-notes>
    <contrast-ratios>
      <ratio combination="Black (#1A1A1A) on Cream (#F9F8F6)" value="~14.7:1" wcag="PASS" usage="Primary text"/>
      <ratio combination="Cream on Black" value="~14.7:1" wcag="PASS" usage="Inverse text"/>
      <ratio combination="Gold (#D4AF37) on Cream (#F9F8F6)" value="~2.5:1" wcag="FAIL for text" usage="Decorative only"/>
      <ratio combination="Gold on Black" value="~5.9:1" wcag="PASS" usage="Gold accents on dark"/>
      <ratio combination="Black on Gold" value="~5.9:1" wcag="PASS" usage="Text on gold buttons"/>
    </contrast-ratios>

    <gold-accent-usage>
      <rule>Use gold for icons, borders, highlights - NOT for body text</rule>
      <rule>Gold text acceptable only on black backgrounds (5.9:1)</rule>
      <rule>For buttons, gold slide-in effect uses white text on gold (contrast OK)</rule>
    </gold-accent-usage>
  </accessibility-notes>

  <files-to-modify>
    <file path="src/app/layout.tsx" action="MODIFY">Add font preloading</file>
    <file path="src/app/globals.css" action="MODIFY">Import design system, add shadcn vars</file>
    <file path="src/components/ui/" action="CREATE">shadcn components directory</file>
    <file path="src/components/ui/button.tsx" action="CREATE">Via shadcn CLI for testing</file>
    <file path="tailwind.config.ts" action="CREATE/MODIFY">Use orionTailwindPreset</file>
    <file path="components.json" action="CREATE">shadcn configuration</file>
    <file path="tests/visual/design-system.spec.ts" action="CREATE">Visual regression tests</file>
    <file path="src/app/design-system-test/page.tsx" action="CREATE">Test page for visual verification</file>
  </files-to-modify>

  <test-infrastructure>
    <dependencies>
      <dependency>@playwright/test</dependency>
      <dependency>@axe-core/playwright</dependency>
      <dependency>vitest</dependency>
      <dependency>@testing-library/react</dependency>
      <dependency>@testing-library/jest-dom</dependency>
    </dependencies>

    <test-file-structure><![CDATA[
tests/
├── unit/
│   ├── story-1.3-typography.spec.ts
│   └── story-1.3-colors.spec.ts
├── integration/
│   └── story-1.3-tailwind.spec.ts
├── e2e/
│   ├── story-1.3-typography.spec.ts
│   ├── story-1.3-colors.spec.ts
│   ├── story-1.3-radius.spec.ts
│   ├── story-1.3-layout.spec.ts
│   └── story-1.3-components.spec.ts
├── visual/
│   └── story-1.3-visual.spec.ts
└── a11y/
    └── story-1.3-contrast.spec.ts
    ]]></test-file-structure>
  </test-infrastructure>

  <references>
    <reference type="story-file">./story-1-3-design-system-foundation.md</reference>
    <reference type="atdd-checklist">./atdd-checklist-1-3-design-system-foundation.md</reference>
    <reference type="architecture">../../planning-artifacts/architecture.md#3.4</reference>
    <reference type="ux-spec">../../planning-artifacts/ux-design-specification.md</reference>
    <reference type="design-system">../../../design-system/README.md</reference>
    <reference type="dependency">./story-1-2-nextjs-frontend-integration.md</reference>
  </references>
</story-context>
